---
- name: Install some default folder for Capistrano
  file:
    path: /home/{{ item.name }}/production/shared/config/
    state: directory
    owner: "{{ item.name }}"
    group: "{{ item.name }}"
  with_items: users
  when: item.rails is defined

- name: Install secrets files for Capistrano
  template: force=no src=secrets.yml.j2 dest=/home/{{ item.name }}/production/shared/config/secrets.yml
            owner={{ item.name }} group={{ item.name }} mode=644
  with_items: users
  when: item.rails is defined

- name: Install mysql files for Capistrano
  template: force=no src=database.yml.j2 dest=/home/{{ item.name }}/production/shared/config/database.yml
            owner={{ item.name }} group={{ item.name }} mode=644
  with_items: users
  when: item.rails is defined and item.mysql is defined

- name: Install mongoid files for Capistrano
  template: force=no src=mongoid.yml.j2 dest=/home/{{ item.name }}/production/shared/config/mongoid.yml
            owner={{ item.name }} group={{ item.name }} mode=644
  with_items: users
  when: item.rails is defined and item.mongodb is defined
