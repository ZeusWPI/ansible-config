- name: Ensure the passenger APT-repository is added
  apt_repository:
    repo: 'deb https://apt.newrelic.com/debian/ newrelic non-free'

- name: Ensure PGP key is installed
  apt_key:
    url: https://download.newrelic.com/548C16BF.gpg
    id: 548C16BF
    state: present
  notify: Update apt

- name: Install New Relic
  apt: name=newrelic-sysmond state=present
  register: new_relic_install

- name: Copy the configuration file
  copy: src=nrsysmond.cfg dest=/etc/newrelic/nrsysmond.cfg
  when: new_relic_install.changed

- name: Ensure New Relic is running
  service: name=newrelic-sysmond state=started enabled=yes
  when: new_relic_install.changed
